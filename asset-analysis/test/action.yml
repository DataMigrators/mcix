# action.yml
name: 'MCIX asset-analysis test action'
author: 'Data Migrators Pty Ltd'
description: 'Runs mcix system version'

inputs:

  api-key:
    description: 'API key for authentication'
    required: true

  url:
    description: 'URL of the DataStage server'
    required: true

  user:
    description: 'Username for authentication'
    required: true

  report:
    description: 'Path to output the compile report'
    required: true
    default: "./compile-report.xml"

  project:
    description: 'DataStage project name'
    required: false     # Required when -project-id not specified
    default: ""

  project-id:
    description: 'DataStage project id'
    required: false     # Required when -project not specified
    default: ""

  rules:
    description: 'Path to the compliance rules'
    required: true
    default: /app/rules

  included-tags:
    description: 'Comma-separated list of tags to include'
    required: false
    default: ""
  
  excluded-tags:
    description: 'Comma-separated list of tags to exclude'
    required: false
    default: ""

  test-suite:
    description: 'Test suite name'
    required: false
    default: 'mcix tests'

  ignore-test-failures:
    description: 'Ignore test failures (always return 0)'
    required: false

outputs:
  return-code:
    description: 'The return code of the command'

runs:
  using: 'docker'
  image: 'Dockerfile' # Refers to the Dockerfile in the current directory
  args:
    - ${{ inputs.api-key }}
    - ${{ inputs.url }}" 
    - ${{ inputs.user }}
    - ${{ inputs.report }}
    - ${{ inputs.project }}
    - ${{ inputs.project-id }}
    - ${{ inputs.rules }}
    - ${{ inputs.included-tags }}
    - ${{ inputs.excluded-tags }}
    - ${{ inputs.test-suite }}"
    - ${{ inputs.ignore-test-failures }}

branding:
  icon: 'search'
  color: 'blue'
